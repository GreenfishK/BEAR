version: "3.0"

services:
# For parallel procesisng
  graphdb_run_1:
    container_name: starvers_graphdb_${policy}_${dataset}
    image: starvers/ontotext/graphdb:9.11.2-se # serves only as a label
    volumes:
      # don't map to /opt/graphdb/home/ !! The license file will not be found 
      # this way because the directory /opt/graphdb/home/conf/ where it was 
      # copied in the graphdb.Dockerfile will get overriden
      - ~/.BEAR/databases/graphdb_${policy}_${dataset}/data:/opt/graphdb/home/data
    hostname: Starvers
    ports:
      - 7200:7200
    restart: unless-stopped

  graphdb_run_2:
    container_name: starvers_graphdb_${policy}_${dataset}
    image: starvers/ontotext/graphdb:9.11.2-se # serves only as a label
    volumes:
      # don't map to /opt/graphdb/home/ !! The license file will not be found 
      # this way because the directory /opt/graphdb/home/conf/ where it was 
      # copied in the graphdb.Dockerfile will get overriden
      - ~/.BEAR/databases/graphdb_${policy}_${dataset}/data:/opt/graphdb/home/data
    ports:
      - 7300:7200
    restart: unless-stopped

  graphdb_run_3:
    container_name: starvers_graphdb_${policy}_${dataset}
    image: starvers/ontotext/graphdb:9.11.2-se # serves only as a label
    volumes:
      # don't map to /opt/graphdb/home/ !! The license file will not be found 
      # this way because the directory /opt/graphdb/home/conf/ where it was 
      # copied in the graphdb.Dockerfile will get overriden
      - ~/.BEAR/databases/graphdb_${policy}_${dataset}/data:/opt/graphdb/home/data
    ports:
      - 7400:7200
    restart: unless-stopped

  graphdb_run_4:
    container_name: starvers_graphdb_${policy}_${dataset}
    image: starvers/ontotext/graphdb:9.11.2-se # serves only as a label
    volumes:
      # don't map to /opt/graphdb/home/ !! The license file will not be found 
      # this way because the directory /opt/graphdb/home/conf/ where it was 
      # copied in the graphdb.Dockerfile will get overriden
      - ~/.BEAR/databases/graphdb_${policy}_${dataset}/data:/opt/graphdb/home/data
    ports:
      - 7500:7200
    restart: unless-stopped
  
  # jenatdb2_run_1
  # jenatdb2_run_2
  # jenatdb2_run_3
  # jenatdb2_run_4

# Commands for testing
# policy=tbsh dataset=bearb-day docker-compose up graphdb_run_1
# policy=tbsf dataset=bearb-day docker-compose up graphdb_run_2