version: "3.0"

services:
# For parallel procesisng
  graphdb_run:
    container_name: starvers_graphdb_${policy}_${dataset}
    image: starvers/ontotext/graphdb:9.11.2-se # serves only as a label
    volumes:
      # don't map to /opt/graphdb/home/ !! The license file will not be found 
      # this way because the directory /opt/graphdb/home/conf/ where it was 
      # copied in the graphdb.Dockerfile will get overriden
      - ~/.BEAR/databases/graphdb_${policy}_${dataset}/data:/opt/graphdb/home/data
    hostname: Starvers
    ports:
      - ${host_port}:7200
    restart: unless-stopped
  
  # jenatdb2_run

  evaluate:
    container_name: starvers_eval
    build:
      context: .
      dockerfile: Dockerfile
    entrypoint: ["python3", "evaluate.py"]
    


# Commands for testing
# policy=tbsh dataset=bearb-day docker-compose up graphdb_run_1
# policy=tbsf dataset=bearb-day docker-compose up graphdb_run_2